<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ML-Driven QoS Network Controller</title>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@300;400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/Leaflet/Leaflet.heat@gh-pages/dist/leaflet-heat.js"></script>
  <style>
    :root {
      --bg: #030c12;
      --panel: #061825;
      --border: #0a4060;
      --accent: #00d4ff;
      --green: #00ff88;
      --yellow: #ffb700;
      --red: #ff3355;
      --text: #c8e8f5;
      --dim: #3a6a80;
      --glow: 0 0 12px rgba(0, 212, 255, 0.4);
      --glow-g: 0 0 12px rgba(0, 255, 136, 0.4);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Rajdhani', sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animated grid background */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(0, 212, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 212, 255, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    header {
      position: relative;
      z-index: 10;
      padding: 20px 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(0, 50, 80, 0.5) 0%, transparent 100%);
    }

    .logo {
      font-family: 'Orbitron', monospace;
      font-size: 1.3rem;
      font-weight: 900;
      color: var(--accent);
      text-shadow: var(--glow);
      letter-spacing: 2px;
    }

    .logo span {
      color: var(--green);
    }

    .status-bar {
      display: flex;
      gap: 24px;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.75rem;
      color: var(--dim);
    }

    .status-bar .live {
      color: var(--green);
      animation: blink 1.5s infinite;
    }

    @keyframes blink {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: 0.3
      }
    }

    .nav {
      display: flex;
      gap: 8px;
    }

    .nav-btn {
      padding: 6px 16px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--dim);
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      letter-spacing: 1px;
      text-transform: uppercase;
      transition: all 0.2s;
    }

    .nav-btn:hover,
    .nav-btn.active {
      border-color: var(--accent);
      color: var(--accent);
      box-shadow: var(--glow);
      background: rgba(0, 212, 255, 0.05);
    }

    .view-section {
      display: none;
      position: relative;
      z-index: 5;
      padding: 30px 40px;
      gap: 20px;
      animation: fadeIn 0.3s ease;
    }

    .view-section.active-view {
      display: block !important;
    }

    #map-container {
      height: 100%;
      width: 100%;
      background: #01080d;
      border: 1px solid var(--border);
      position: relative;
      z-index: 1;
    }

    .map-overlay {
      position: absolute;
      top: 15px;
      left: 15px;
      z-index: 1000;
      display: flex;
      gap: 10px;
      background: rgba(3, 12, 18, 0.85);
      padding: 10px;
      border: 1px solid var(--accent);
      border-radius: 4px;
      backdrop-filter: blur(5px);
    }

    .map-input {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--border);
      color: #fff;
      padding: 5px 10px;
      font-family: 'Share Tech Mono', monospace;
      outline: none;
      width: 200px;
    }

    .map-input:focus {
      border-color: var(--accent);
    }

    .map-btn {
      background: var(--accent);
      color: #000;
      border: none;
      padding: 5px 12px;
      cursor: pointer;
      font-family: 'Rajdhani', sans-serif;
      font-weight: bold;
      transition: 0.2s;
    }

    .map-btn:hover {
      filter: brightness(1.2);
    }

    .hub-pulse {
      width: 12px;
      height: 12px;
      background: var(--accent);
      border-radius: 50%;
      box-shadow: 0 0 10px var(--accent);
      animation: hubPulse 2s infinite;
    }

    @keyframes hubPulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      100% {
        transform: scale(2.5);
        opacity: 0;
      }
    }

    .user-tooltip {
      background: rgba(255, 68, 68, 0.9);
      border: 1px solid #fff;
      color: #fff;
      font-family: 'Share Tech Mono', monospace;
      font-weight: bold;
      font-size: 0.7rem;
      box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
      border-radius: 0;
    }

    .user-tooltip::before {
      border-top-color: rgba(255, 68, 68, 0.9);
    }

    .hub-icon-container {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    #view-dashboard {
      grid-template-columns: 280px 1fr 280px;
      grid-template-rows: auto auto auto;
    }

    #view-analytics,
    #view-config,
    #view-logs {
      grid-template-columns: 1fr;
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      opacity: 0.6;
    }

    .panel-title {
      font-family: 'Orbitron', monospace;
      font-size: 0.65rem;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-title::after {
      content: '';
      flex: 1;
      height: 1px;
      background: linear-gradient(90deg, var(--border), transparent);
    }

    /* Traffic Sources Panel */
    .traffic-sources {
      grid-column: 1;
      grid-row: 1;
    }

    .traffic-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid rgba(10, 64, 96, 0.5);
    }

    .traffic-item:last-child {
      border: none;
    }

    .t-label {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      font-size: 0.95rem;
    }

    .t-icon {
      width: 36px;
      height: 36px;
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      color: var(--accent);
    }

    .t-bar-wrap {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .t-val {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.8rem;
      color: var(--accent);
    }

    .t-bar {
      width: 80px;
      height: 4px;
      background: rgba(10, 64, 96, 0.8);
    }

    .t-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--green));
      transition: width 1s;
    }

    /* Center - Main Flow */
    .main-flow {
      grid-column: 2;
      grid-row: 1 / 4;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Monitoring Panel */
    .monitoring-panel {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 20px;
      position: relative;
    }

    .monitoring-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      opacity: 0.6;
    }

    .metrics-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      margin-top: 4px;
    }

    .metric-box {
      border: 1px solid var(--border);
      padding: 12px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .metric-val {
      font-family: 'Orbitron', monospace;
      font-size: 1.6rem;
      font-weight: 700;
      color: var(--green);
      text-shadow: var(--glow-g);
      display: block;
    }

    .metric-label {
      font-size: 0.7rem;
      color: var(--dim);
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-top: 4px;
    }

    .metric-unit {
      font-size: 0.75rem;
      color: var(--dim);
    }

    /* ML Predictor */
    .ml-panel {
      background: linear-gradient(135deg, #041520, #061c10);
      border: 1px solid #0a5030;
      padding: 20px;
      position: relative;
    }

    .ml-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--green), transparent);
    }

    .congestion-states {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .state {
      flex: 1;
      padding: 12px 8px;
      text-align: center;
      border: 1px solid transparent;
      font-weight: 700;
      font-size: 0.85rem;
      letter-spacing: 1px;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }

    .state-low {
      border-color: rgba(0, 255, 136, 0.3);
      color: var(--green);
      background: rgba(0, 255, 136, 0.05);
    }

    .state-med {
      border-color: rgba(255, 183, 0, 0.3);
      color: var(--yellow);
      background: rgba(255, 183, 0, 0.05);
    }

    .state-high {
      border-color: rgba(255, 51, 85, 0.3);
      color: var(--red);
      background: rgba(255, 51, 85, 0.05);
    }

    .state.active-state {
      border-width: 2px;
    }

    .state-low.active-state {
      background: rgba(0, 255, 136, 0.15);
      box-shadow: 0 0 16px rgba(0, 255, 136, 0.3);
    }

    .state-med.active-state {
      background: rgba(255, 183, 0, 0.15);
      box-shadow: 0 0 16px rgba(255, 183, 0, 0.3);
    }

    .state-high.active-state {
      background: rgba(255, 51, 85, 0.15);
      box-shadow: 0 0 16px rgba(255, 51, 85, 0.3);
    }

    .state-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin: 0 auto 6px;
    }

    .state-low .state-indicator {
      background: var(--green);
      box-shadow: 0 0 8px var(--green);
    }

    .state-med .state-indicator {
      background: var(--yellow);
      box-shadow: 0 0 8px var(--yellow);
    }

    .state-high .state-indicator {
      background: var(--red);
      box-shadow: 0 0 8px var(--red);
    }

    /* QoS Controller */
    .qos-panel {
      background: linear-gradient(135deg, #041520, #071025);
      border: 1px solid #082040;
      padding: 20px;
      position: relative;
    }

    .qos-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, #6060ff, transparent);
    }

    .qos-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .qos-sub {
      border: 1px solid var(--border);
      padding: 12px;
    }

    .qos-sub-title {
      font-size: 0.7rem;
      color: var(--dim);
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .queue-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
      font-size: 0.8rem;
    }

    .q-num {
      font-family: 'Share Tech Mono', monospace;
      color: var(--accent);
      width: 16px;
    }

    .q-bar-bg {
      flex: 1;
      height: 6px;
      background: rgba(10, 64, 96, 0.5);
    }

    .q-bar {
      height: 100%;
      background: linear-gradient(90deg, #4080ff, var(--accent));
    }

    .bw-item {
      margin-bottom: 8px;
    }

    .bw-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--dim);
      margin-bottom: 4px;
    }

    .bw-val {
      color: var(--accent);
      font-family: 'Share Tech Mono', monospace;
    }

    .bw-bar-bg {
      height: 6px;
      background: rgba(10, 64, 96, 0.5);
    }

    .bw-fill {
      height: 100%;
      background: linear-gradient(90deg, #4080ff, var(--green));
    }

    /* Performance Panel */
    .perf-panel {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 20px;
      position: relative;
    }

    .perf-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--yellow), transparent);
    }

    .perf-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }

    .perf-box {
      border: 1px solid var(--border);
      padding: 12px;
      text-align: center;
    }

    .perf-icon {
      font-size: 1.4rem;
      margin-bottom: 6px;
    }

    .perf-val {
      font-family: 'Orbitron', monospace;
      font-size: 1.2rem;
      font-weight: 700;
      display: block;
      margin-bottom: 4px;
    }

    .perf-label {
      font-size: 0.7rem;
      color: var(--dim);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Mini chart canvas */
    canvas.sparkline {
      width: 100%;
      height: 60px;
      display: block;
      margin-top: 10px;
    }

    /* Right panels */
    .right-col {
      grid-column: 3;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .feature-panel {
      grid-column: 1;
      grid-row: 2 / 4;
    }

    .alert-feed {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 20px;
      flex: 1;
    }

    .alert-feed::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--red), transparent);
    }

    .alert-feed {
      position: relative;
      overflow: hidden;
    }

    .alert-list {
      max-height: 200px;
      overflow: hidden;
    }

    .alert-item {
      display: flex;
      gap: 10px;
      padding: 6px 0;
      border-bottom: 1px solid rgba(10, 64, 96, 0.3);
      font-size: 0.75rem;
      font-family: 'Share Tech Mono', monospace;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }

      to {
        opacity: 1;
        transform: none;
      }
    }

    .alert-time {
      color: var(--dim);
      white-space: nowrap;
    }

    .alert-msg {
      color: var(--text);
    }

    .alert-msg.warn {
      color: var(--yellow);
    }

    .alert-msg.crit {
      color: var(--red);
    }

    .alert-msg.ok {
      color: var(--green);
    }

    /* Bottleneck router */
    .router-panel {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 20px;
      position: relative;
    }

    .router-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
    }

    .router-viz {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .router-node {
      width: 50px;
      height: 50px;
      border: 2px solid var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      position: relative;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        box-shadow: 0 0 8px rgba(0, 212, 255, 0.3)
      }

      50% {
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.7)
      }
    }

    .link-line {
      height: 2px;
      width: 20px;
      background: linear-gradient(90deg, var(--accent), var(--green));
      position: relative;
      overflow: hidden;
    }

    .link-line::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, white, transparent);
      animation: flow 1.5s linear infinite;
    }

    @keyframes flow {
      to {
        left: 100%;
      }
    }

    .utilization-wrap {
      margin-top: 14px;
    }

    .util-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      margin-bottom: 6px;
    }

    .util-label {
      color: var(--dim);
    }

    .util-val {
      font-family: 'Share Tech Mono', monospace;
      color: var(--accent);
    }

    .util-bar-bg {
      height: 8px;
      background: rgba(10, 64, 96, 0.5);
      margin-bottom: 10px;
    }

    .util-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--green));
      position: relative;
      transition: width 1.5s;
    }

    /* Connector arrows */
    .connector {
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--accent);
      font-size: 1.2rem;
      opacity: 0.6;
      padding: 4px 0;
    }

    /* Feedback arrow indicator */
    .feedback-badge {
      position: absolute;
      right: -8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.65rem;
      color: var(--dim);
      writing-mode: vertical-rl;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    /* Chart section */
    .chart-section {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 20px;
      position: relative;
      grid-column: 1 / 4;
    }

    .chart-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--green), transparent);
    }

    .chart-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin-top: 4px;
    }

    .chart-box {
      position: relative;
    }

    .chart-box-title {
      font-size: 0.7rem;
      color: var(--dim);
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    canvas.linechart {
      width: 100%;
      height: 80px;
    }

    footer {
      position: relative;
      z-index: 5;
      padding: 16px 40px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.7rem;
      color: var(--dim);
    }

    /* Responsive */
    @media(max-width:1100px) {
      #view-dashboard {
        grid-template-columns: 1fr 1fr;
      }

      .main-flow {
        grid-column: 1 / 3;
      }

      .right-col {
        grid-column: 1 / 3;
        flex-direction: row;
      }

      .feature-panel {
        display: none;
      }
    }

    /* Feature list */
    .feature-list {
      margin-top: 4px;
    }

    .feat-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 0;
      border-bottom: 1px solid rgba(10, 64, 96, 0.3);
      font-size: 0.85rem;
    }

    .feat-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
      flex-shrink: 0;
      box-shadow: 0 0 6px var(--accent);
    }

    .feat-val {
      margin-left: auto;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.75rem;
      color: var(--accent);
    }

    .feat-tag {
      border: 1px solid var(--border);
      padding: 4px 10px;
      font-size: 0.75rem;
      color: var(--dim);
      font-family: 'Share Tech Mono', monospace;
      transition: all 0.3s;
    }

    .feat-tag.active-feat {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(0, 212, 255, 0.1);
      box-shadow: 0 0 5px var(--accent);
    }
  </style>
</head>

<body>

  <header>
    <div class="logo">DCN<span>PROJECT</span></div>
    <div class="status-bar">
      <span>SYS: <span class="live">‚óè ONLINE</span></span>
      <span>NODES: 24</span>
      <span>UPTIME: 99.97%</span>
      <span id="clock">00:00:00</span>
    </div>
    <div class="nav">
      <button class="nav-btn active" data-target="view-dashboard">DASHBOARD</button>
      <button class="nav-btn" data-target="view-analytics">ANALYTICS</button>
      <button class="nav-btn" data-target="view-map">MAP</button>
      <button class="nav-btn" data-target="view-dataset">DATASET</button>
      <button class="nav-btn" data-target="view-config">CONFIG</button>
      <button class="nav-btn" data-target="view-logs">LOGS</button>
    </div>
  </header>

  <main id="view-dashboard" class="view-section active-view">
    <!-- Left: Traffic Sources -->
    <div class="panel traffic-sources">
      <div class="panel-title">Traffic Sources</div>
      <div class="traffic-item">
        <div class="t-label">
          <div class="t-icon">üìû</div>
          VoIP
        </div>
        <div class="t-bar-wrap">
          <span class="t-val" id="voip-val">142 Kbps</span>
          <div class="t-bar">
            <div class="t-fill" id="voip-bar" style="width:35%"></div>
          </div>
        </div>
      </div>
      <div class="traffic-item">
        <div class="t-label">
          <div class="t-icon">üåê</div>
          HTTP
        </div>
        <div class="t-bar-wrap">
          <span class="t-val" id="http-val">4.7 Mbps</span>
          <div class="t-bar">
            <div class="t-fill" id="http-bar" style="width:72%"></div>
          </div>
        </div>
      </div>
      <div class="traffic-item">
        <div class="t-label">
          <div class="t-icon">üìÅ</div>
          FTP
        </div>
        <div class="t-bar-wrap">
          <span class="t-val" id="ftp-val">2.1 Mbps</span>
          <div class="t-bar">
            <div class="t-fill" id="ftp-bar" style="width:52%"></div>
          </div>
        </div>
      </div>
      <div style="margin-top:16px;">
        <div style="font-size:0.7rem;color:var(--dim);letter-spacing:1px;text-transform:uppercase;margin-bottom:8px;">
          Aggregate Load</div>
        <canvas id="trafficChart" class="sparkline"></canvas>
      </div>
    </div>

    <!-- Center: Main Pipeline -->
    <div class="main-flow">
      <!-- Traffic Monitoring -->
      <div class="monitoring-panel">
        <div class="panel-title">‚¨¢ Traffic Monitoring</div>
        <div class="metrics-row">
          <div class="metric-box">
            <span class="metric-val" id="arrival-rate">847</span>
            <span class="metric-unit">pkt/s</span>
            <div class="metric-label">Arrival Rate</div>
          </div>
          <div class="metric-box">
            <span class="metric-val" id="delay-val">12.4</span>
            <span class="metric-unit">ms</span>
            <div class="metric-label">Delay</div>
          </div>
          <div class="metric-box">
            <span class="metric-val" id="queue-val">234</span>
            <span class="metric-unit">pkts</span>
            <div class="metric-label">Queue Length</div>
          </div>
        </div>
      </div>

      <div class="connector">‚ñº</div>

      <!-- Feature Extraction -->
      <div class="panel" style="padding:14px 20px;">
        <div class="panel-title" style="display:flex; justify-content:space-between;">
          <span>‚¨° Feature Extraction</span>
          <span
            style="color:var(--green); font-size:0.7rem; border:1px solid var(--green); padding:2px 6px; border-radius:3px;">SYSTEM
            ENABLED</span>
        </div>
        <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <span class="feat-tag" id="feat-jitter">jitter</span>
          <span class="feat-tag" id="feat-tput">throughput</span>
          <span class="feat-tag" id="feat-loss">loss_rate</span>
          <span class="feat-tag" id="feat-rtt">rtt</span>
          <span class="feat-tag" id="feat-burst">burstiness</span>
        </div>

        <div
          style="margin-top:15px; padding:10px; background:rgba(0,0,0,0.3); border:1px solid var(--border); font-family:'Share Tech Mono',monospace; font-size:0.8rem;">
          <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
            <span style="color:var(--dim);">Identified Flow:</span>
            <span id="extraction-app" style="color:var(--accent);">ANALYZING...</span>
          </div>
          <div style="display:flex; justify-content:space-between;">
            <span style="color:var(--dim);">Raw Feature Vector:</span>
            <span id="feature-vector" style="color:var(--green);">[0.0, 0.0, 0.0, 0.0, 0.0]</span>
          </div>
        </div>

        <div
          style="margin-top: 10px; background: rgba(0, 212, 255, 0.1); height: 2px; position: relative; overflow: hidden;">
          <div id="feature-progress"
            style="position: absolute; height: 100%; width: 30%; background: var(--accent); left: -100%; transition: left 1.5s linear;">
          </div>
        </div>
        <div
          style="margin-top:5px; text-align:right; font-size:0.65rem; color:var(--dim); font-family:'Share Tech Mono',monospace;">
          STREAMS PIPELINE: <span id="extraction-status">COLLECTING</span>
        </div>
      </div>

      <div class="connector">‚ñº</div>

      <!-- ML Predictor -->
      <div class="ml-panel">
        <div class="panel-title" style="color:var(--green);">‚óà using ml for traffic network</div>
        <div style="font-size:0.75rem;color:var(--dim);margin-bottom:10px;font-family:'Share Tech Mono',monospace;">
          Model: Random Forest ¬∑ Accuracy: <span style="color:var(--green);">96.8%</span> ¬∑ Last inference: <span
            id="infer-time">12ms</span>
        </div>
        <div class="congestion-states">
          <div class="state state-low active-state" id="state-low">
            <div class="state-indicator"></div>
            Low
          </div>
          <div class="state state-med" id="state-med">
            <div class="state-indicator"></div>
            Medium
          </div>
          <div class="state state-high" id="state-high">
            <div class="state-indicator"></div>
            High
          </div>
        </div>
        <div style="margin-top:12px;font-size:0.75rem;color:var(--dim);font-family:'Share Tech Mono',monospace;">
          Confidence: <span style="color:var(--green);" id="confidence">94.2%</span> &nbsp;|&nbsp; Prediction horizon:
          5s
        </div>
      </div>

      <div class="connector">‚ñº</div>

      <!-- Adaptive QoS Controller -->
      <div class="qos-panel">
        <div class="panel-title" style="color:#8888ff;">‚¨° Adaptive QoS Controller</div>
        <div class="qos-grid">
          <div class="qos-sub">
            <div class="qos-sub-title">Priority Queuing</div>
            <div class="queue-row">
              <span class="q-num">1</span>
              <div class="q-bar-bg">
                <div class="q-bar" id="q1" style="width:85%"></div>
              </div>
              <span style="font-size:0.7rem;color:var(--dim);font-family:'Share Tech Mono',monospace;">VoIP</span>
            </div>
            <div class="queue-row">
              <span class="q-num">2</span>
              <div class="q-bar-bg">
                <div class="q-bar" id="q2" style="width:60%"></div>
              </div>
              <span style="font-size:0.7rem;color:var(--dim);font-family:'Share Tech Mono',monospace;">HTTP</span>
            </div>
            <div class="queue-row">
              <span class="q-num">3</span>
              <div class="q-bar-bg">
                <div class="q-bar" id="q3" style="width:40%"></div>
              </div>
              <span style="font-size:0.7rem;color:var(--dim);font-family:'Share Tech Mono',monospace;">FTP</span>
            </div>
          </div>
          <div class="qos-sub">
            <div class="qos-sub-title">Bandwidth Allocation</div>
            <div class="bw-item">
              <div class="bw-label"><span>VoIP</span><span class="bw-val" id="bw1">40%</span></div>
              <div class="bw-bar-bg">
                <div class="bw-fill" id="bwf1" style="width:40%"></div>
              </div>
            </div>
            <div class="bw-item">
              <div class="bw-label"><span>HTTP</span><span class="bw-val" id="bw2">35%</span></div>
              <div class="bw-bar-bg">
                <div class="bw-fill" id="bwf2" style="width:35%"></div>
              </div>
            </div>
            <div class="bw-item">
              <div class="bw-label"><span>FTP</span><span class="bw-val" id="bw3">25%</span></div>
              <div class="bw-bar-bg">
                <div class="bw-fill" id="bwf3" style="width:25%"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="connector">‚ñº</div>

      <!-- Bottleneck Router -->
      <div class="router-panel">
        <div class="panel-title">‚óà Bottleneck Router / Link</div>
        <div class="router-viz">
          <div class="router-node">üñ•</div>
          <div class="link-line"></div>
          <div class="router-node" style="border-color:var(--yellow);animation-name:pulse-y;">‚¨°</div>
          <div class="link-line"></div>
          <div class="router-node">üñ•</div>
        </div>
        <div class="utilization-wrap">
          <div class="util-row"><span class="util-label">Link Utilization</span><span class="util-val"
              id="link-util">67%</span></div>
          <div class="util-bar-bg">
            <div class="util-fill" id="link-fill" style="width:67%"></div>
          </div>
          <div class="util-row"><span class="util-label">Queue Occupancy</span><span class="util-val"
              id="queue-occ">43%</span></div>
          <div class="util-bar-bg">
            <div class="util-fill" id="queue-fill"
              style="width:43%;background:linear-gradient(90deg,#8888ff,var(--accent));"></div>
          </div>
        </div>
      </div>

      <div class="connector">‚ñº</div>

      <!-- Performance Analyzer -->
      <div class="perf-panel">
        <div class="panel-title" style="color:var(--yellow);">‚óâ Performance Analyzer</div>
        <div class="perf-metrics">
          <div class="perf-box">
            <div class="perf-icon">‚è±</div>
            <span class="perf-val" id="perf-delay" style="color:var(--green);">12.4 ms</span>
            <div class="perf-label">Delay</div>
          </div>
          <div class="perf-box">
            <div class="perf-icon">üìà</div>
            <span class="perf-val" id="perf-tput" style="color:var(--accent);">4.7 Gbps</span>
            <div class="perf-label">Throughput</div>
          </div>
          <div class="perf-box">
            <div class="perf-icon">üì¶</div>
            <span class="perf-val" id="perf-loss" style="color:var(--yellow);">0.12%</span>
            <div class="perf-label">Packet Loss</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div class="right-col">
      <!-- Alert Feed -->
      <div class="alert-feed panel">
        <div class="panel-title" style="color:var(--red);">‚¨° Event Log</div>
        <div class="alert-list" id="alert-list">
          <div class="alert-item"><span class="alert-time">08:14:02</span><span class="alert-msg ok">QoS policy updated
              ‚Äî Low congestion</span></div>
          <div class="alert-item"><span class="alert-time">08:13:47</span><span class="alert-msg">Feature vector
              extracted successfully</span></div>
          <div class="alert-item"><span class="alert-time">08:13:31</span><span class="alert-msg warn">Queue depth
              approaching threshold</span></div>
          <div class="alert-item"><span class="alert-time">08:13:10</span><span class="alert-msg">Bandwidth reallocated
              ‚Äî HTTP +5%</span></div>
          <div class="alert-item"><span class="alert-time">08:12:55</span><span class="alert-msg crit">High congestion
              predicted ‚Äî action taken</span></div>
          <div class="alert-item"><span class="alert-time">08:12:30</span><span class="alert-msg">ML model inference:
              11ms</span></div>
        </div>
      </div>

      <!-- Model Stats -->
      <div class="panel">
        <div class="panel-title" style="color:var(--green);">Model Stats</div>
        <div style="font-size:0.75rem;font-family:'Share Tech Mono',monospace;">
          <div
            style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);color:var(--dim);">
            <span>Algorithm</span><span style="color:var(--accent);">Random Forest</span>
          </div>
          <div
            style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);color:var(--dim);">
            <span>Accuracy</span><span style="color:var(--green);">96.8%</span>
          </div>
          <div
            style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);color:var(--dim);">
            <span>Precision</span><span style="color:var(--green);">95.3%</span>
          </div>
          <div
            style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);color:var(--dim);">
            <span>Recall</span><span style="color:var(--green);">97.1%</span>
          </div>
          <div style="display:flex;justify-content:space-between;padding:6px 0;color:var(--dim);">
            <span>F1 Score</span><span style="color:var(--green);">0.962</span>
          </div>
        </div>
      </div>

      <!-- Feedback note -->
      <div class="panel" style="border-color:rgba(0,212,255,0.2);">
        <div class="panel-title">Feedback Loop</div>
        <div style="font-size:0.8rem;color:var(--dim);line-height:1.6;">
          Performance metrics feed back into <span style="color:var(--accent);">Traffic Monitoring</span> to
          continuously retrain and adapt the <span style="color:var(--green);">ML for Traffic Network</span> in
          real-time.
        </div>
        <div
          style="margin-top:12px;display:flex;align-items:center;gap:8px;font-size:0.7rem;font-family:'Share Tech Mono',monospace;color:var(--dim);">
          <span style="color:var(--green);">‚óè</span> Feedback active &nbsp; <span style="color:var(--accent);">‚Ü∫</span>
          Cycle: 5s
        </div>
      </div>
    </div>

    <!-- Bottom Charts -->
    <div class="chart-section" style="grid-row:3;grid-column:1/3">
      <div class="panel-title" style="color:var(--green);">‚óà Real-Time Performance Metrics</div>
      <div class="chart-row">
        <div class="chart-box">
          <div class="chart-box-title">Delay (ms)</div>
          <canvas id="delayChart" class="linechart"></canvas>
        </div>
        <div class="chart-box">
          <div class="chart-box-title">Throughput (Mbps)</div>
          <canvas id="tputChart" class="linechart"></canvas>
        </div>
        <div class="chart-box">
          <div class="chart-box-title">Packet Loss (%)</div>
          <canvas id="lossChart" class="linechart"></canvas>
        </div>
      </div>
    </div>

  </main>

  <main id="view-map" class="view-section">
    <div class="panel" style="height: calc(100vh - 180px); display: flex; flex-direction: column;">
      <div class="panel-title">
        <div class="t-icon">üåê</div> Global Network Traffic Map
      </div>
      <div
        style="flex: 1; margin: 15px 0; border: 1px solid var(--border); border-radius: 4px; overflow: hidden; background: #000; position: relative;">
        <div class="map-overlay">
          <input type="text" id="map-search-input" class="map-input" placeholder="ENTER LOCATION AREA...">
          <button class="map-btn" onclick="searchLocation()">TARGET</button>
          <button class="map-btn" style="background: var(--green);" onclick="autoDetectLocation()">AUTO-SCAN</button>
        </div>
        <div id="map-container"></div>
      </div>
    </div>
  </main>
  <main id="view-dataset" class="view-section">
    <div class="panel" style="height: calc(100vh - 180px); overflow: hidden; display: flex; flex-direction: column;">
      <div class="panel-title">
        <div class="t-icon">üìä</div> Network Metric Dataset (Excel View)
      </div>
      <div style="flex: 1; overflow: auto; margin-top: 15px; border: 1px solid var(--border);">
        <table id="dataset-table" style="width: 100%; border-collapse: collapse; font-size: 0.8rem; text-align: left;">
          <thead style="position: sticky; top: 0; background: var(--bg-card); z-index: 10;">
            <tr>
              <th style="padding: 10px; border-bottom: 2px solid var(--accent); color: var(--accent);">TIMESTAMP</th>
              <th style="padding: 10px; border-bottom: 2px solid var(--accent); color: var(--accent);">VOIP (K)</th>
              <th style="padding: 10px; border-bottom: 2px solid var(--accent); color: var(--accent);">HTTP (M)</th>
              <th style="padding: 10px; border-bottom: 2px solid var(--accent); color: var(--accent);">FTP (M)</th>
              <th style="padding: 10px; border-bottom: 2px solid var(--accent); color: var(--accent);">DELAY (MS)</th>
              <th style="padding: 10px; border-bottom: 2px solid var(--accent); color: var(--accent);">THROUGHPUT</th>
              <th style="padding: 10px; border-bottom: 2px solid var(--accent); color: var(--accent);">LOSS (%)</th>
              <th style="padding: 10px; border-bottom: 2px solid var(--accent); color: var(--accent);">STATE</th>
            </tr>
          </thead>
          <tbody id="dataset-body">
            <!-- Rows added via JS -->
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <main id="view-analytics" class="view-section">
    <div class="panel">
      <div class="panel-title">Analytics Engine</div>
      <div style="padding: 40px; text-align: center; color: var(--dim);">
        <h2>Advanced Network Analytics</h2>
        <p style="margin-top: 10px;">Historical data parsing and predictive model training interface.</p>
        <div style="margin-top: 50px; display: flex; justify-content: center; gap: 40px; flex-wrap: wrap;">
          <div class="perf-box" style="width: 250px;">
            <div class="perf-icon">üß†</div>
            <span class="perf-val">Random Forest</span>
            <div class="perf-label">Active Classifier</div>
          </div>
          <div class="perf-box" style="width: 250px;">
            <div class="perf-icon" style="color:var(--green);">üéØ</div>
            <span class="perf-val" style="color:var(--green);" id="analytics-accuracy">96.8%</span>
            <div class="perf-label">Validation Accuracy</div>
          </div>
          <div class="perf-box" style="width: 250px;">
            <div class="perf-icon" style="color:var(--accent);">‚è±</div>
            <span class="perf-val" style="color:var(--accent);" id="analytics-infer">~11ms</span>
            <div class="perf-label">Average Inference Time</div>
          </div>
        </div>
        <div
          style="margin-top: 30px; display: flex; align-items: center; justify-content: center; gap: 10px; font-family: 'Share Tech Mono', monospace; font-size: 0.9rem;">
          <div
            style="width: 10px; height: 10px; border-radius: 50%; background: var(--green); box-shadow: 0 0 10px var(--green); animation: pulse 1s infinite;">
          </div>
          <span id="analytics-status" style="color: var(--green);">ENGINE ACTIVE: CONTINUOUS LEARNING PIPELINE</span>
        </div>
        <div
          style="margin-top: 30px; text-align: center; font-size: 0.8rem; color: var(--dim); padding: 20px; border: 1px dashed var(--border);">
          <p>A simulated Machine Learning component analyzes load in real-time derived from Traffic Flow volume.</p>
          <p style="margin-top: 8px;">Because this is an active simulation loop, the metrics naturally build and release
            congestion states dynamically via the API.</p>
        </div>
      </div>
    </div>

    <div class="panel" style="margin-top: 20px;">
      <div class="panel-title" style="color: var(--accent);">‚¨° Deep Packet Inspection: Application Flow Control</div>
      <div style="padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">

        <!-- Education (Full Access) -->
        <div>
          <h3
            style="color: var(--green); margin-bottom: 20px; font-size: 1.1rem; display: flex; justify-content: space-between;">
            <span>üéì Educational (Priority: HIGH)</span>
            <span style="font-family: 'Share Tech Mono', monospace; font-size: 0.85rem;">Status: FULL DATA</span>
          </h3>

          <div class="bw-item" style="margin-bottom: 16px;">
            <div class="bw-label"><span style="color: var(--text);">Coursera / edX Video Streams</span><span
                class="bw-val" id="app-edu1-val">45 Mbps</span></div>
            <div class="bw-bar-bg" style="height: 10px; border-radius: 4px;">
              <div class="bw-fill" id="app-edu1-bar"
                style="width:85%; background: linear-gradient(90deg, var(--green), #00ffaa); border-radius: 4px;"></div>
            </div>
          </div>

          <div class="bw-item" style="margin-bottom: 16px;">
            <div class="bw-label"><span style="color: var(--text);">Wikipedia / Research Portals</span><span
                class="bw-val" id="app-edu2-val">12 Mbps</span></div>
            <div class="bw-bar-bg" style="height: 10px; border-radius: 4px;">
              <div class="bw-fill" id="app-edu2-bar"
                style="width:30%; background: linear-gradient(90deg, var(--green), #00ffaa); border-radius: 4px;"></div>
            </div>
          </div>

          <div class="bw-item" style="margin-bottom: 16px;">
            <div class="bw-label"><span style="color: var(--text);">University CMS (Canvas/Moodle)</span><span
                class="bw-val" id="app-edu3-val">28 Mbps</span></div>
            <div class="bw-bar-bg" style="height: 10px; border-radius: 4px;">
              <div class="bw-fill" id="app-edu3-bar"
                style="width:65%; background: linear-gradient(90deg, var(--green), #00ffaa); border-radius: 4px;"></div>
            </div>
          </div>
        </div>

        <!-- Entertainment (Limited Access) -->
        <div>
          <h3
            style="color: var(--yellow); margin-bottom: 20px; font-size: 1.1rem; display: flex; justify-content: space-between;">
            <span>üéÆ Entertainment (Priority: SCAVENGER)</span>
            <span style="font-family: 'Share Tech Mono', monospace; font-size: 0.85rem; color: var(--red);">Status:
              THROTTLED</span>
          </h3>

          <div class="bw-item" style="margin-bottom: 16px;">
            <div class="bw-label"><span style="color: var(--text); opacity: 0.7;">Netflix / YouTube 4K</span><span
                class="bw-val" id="app-ent1-val" style="color: var(--red);">5 Mbps (Capped)</span></div>
            <div class="bw-bar-bg" style="height: 10px; border-radius: 4px; border: 1px dotted var(--red);">
              <div class="bw-fill" id="app-ent1-bar"
                style="width:15%; background: linear-gradient(90deg, var(--red), var(--yellow)); border-radius: 4px; transition: width 0.5s;">
              </div>
            </div>
          </div>

          <div class="bw-item" style="margin-bottom: 16px;">
            <div class="bw-label"><span style="color: var(--text); opacity: 0.7;">TikTok / Instagram Reels</span><span
                class="bw-val" id="app-ent2-val" style="color: var(--red);">2 Mbps (Capped)</span></div>
            <div class="bw-bar-bg" style="height: 10px; border-radius: 4px; border: 1px dotted var(--red);">
              <div class="bw-fill" id="app-ent2-bar"
                style="width:8%; background: linear-gradient(90deg, var(--red), var(--yellow)); border-radius: 4px; transition: width 0.5s;">
              </div>
            </div>
          </div>

          <div class="bw-item" style="margin-bottom: 16px;">
            <div class="bw-label"><span style="color: var(--text); opacity: 0.7;">Steam Game Downloads</span><span
                class="bw-val" id="app-ent3-val" style="color: var(--red);">10 Mbps (Capped)</span></div>
            <div class="bw-bar-bg" style="height: 10px; border-radius: 4px; border: 1px dotted var(--red);">
              <div class="bw-fill" id="app-ent3-bar"
                style="width:25%; background: linear-gradient(90deg, var(--red), var(--yellow)); border-radius: 4px; transition: width 0.5s;">
              </div>
            </div>
          </div>
        </div>

      </div>
      <div
        style="padding: 0 20px 20px 20px; font-size: 0.75rem; color: var(--dim); font-family: 'Share Tech Mono', monospace; display: flex; gap: 20px;">
        <span><strong style="color:var(--accent);">POLICY:</strong> Edu-Priority-V2</span>
        <span><strong style="color:var(--accent);">DPI ENGINE:</strong> Active (Layer 7 Inspection)</span>
        <span style="margin-left:auto;">System actively dropping entertainment UDP packets to preserve Quality of
          Service for Educational platforms.</span>
      </div>
    </div>
  </main>

  <main id="view-config" class="view-section">
    <div class="panel">
      <div class="panel-title">QoS Policy Configuration</div>
      <div style="padding: 20px 40px; color: var(--text);">
        <h3 style="color: var(--accent); margin-bottom: 30px;">Traffic Shaping Rules</h3>
        <div style="display:flex; flex-direction:column; gap:25px; max-width: 500px;">
          <div
            style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(10,64,96,0.3); padding-bottom: 10px;">
            <div style="display: flex; flex-direction: column;">
              <label style="font-weight: 600;">VoIP Protection Allocation</label>
              <span style="font-size: 0.7rem; color: var(--dim); margin-top: 4px;">Guaranteed bandwidth percentage
                during High Congestion</span>
            </div>
            <input type="range" id="config-voip-alloc" min="10" max="80" value="50" style="width: 150px;">
          </div>
          <div
            style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(10,64,96,0.3); padding-bottom: 10px;">
            <div style="display: flex; flex-direction: column;">
              <label style="font-weight: 600;">Congestion Threshold Warning</label>
              <span style="font-size: 0.7rem; color: var(--dim); margin-top: 4px;">Trigger level for transitioning to
                Medium congestion</span>
            </div>
            <input type="range" id="config-threshold" min="0" max="1" step="0.05" value="0.4" style="width: 150px;">
          </div>
          <div
            style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(10,64,96,0.3); padding-bottom: 10px;">
            <div style="display: flex; flex-direction: column;">
              <label style="font-weight: 600;">Default FTP Priority Class</label>
              <span style="font-size: 0.7rem; color: var(--dim); margin-top: 4px;">How non-real-time file transfers are
                queued globally</span>
            </div>
            <select id="config-ftp-prio"
              style="background:var(--bg); color:var(--text); border:1px solid var(--accent); padding:6px 10px; width: 150px; font-family: 'Rajdhani', sans-serif;">
              <option value="low">Low (Scavenger)</option>
              <option value="std" selected>Standard (Best Effort)</option>
              <option value="high">High (Expedited)</option>
            </select>
          </div>

          <div style="margin-top: 20px; display: flex; gap: 15px;">
            <button class="nav-btn" style="flex: 1;" onclick="applyConfig()">Apply Policy</button>
            <button class="nav-btn" style="border-color: var(--dim); color: var(--dim);" onclick="resetConfig()">Reset
              Defaults</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <main id="view-logs" class="view-section">
    <div class="panel" style="height: 60vh; overflow-y: auto;">
      <div class="panel-title">System Event Logs</div>
      <div id="full-log-list" style="font-family: 'Share Tech Mono', monospace; font-size: 0.85rem; line-height: 1.8;">
        <div class="alert-item" style="border-bottom: 1px solid rgba(10,64,96,0.3); padding: 8px 0;"><span
            class="alert-time" style="color:var(--dim); width: 80px; display:inline-block;">SYSTEM</span><span
            class="alert-msg">Logging engine initialized... awaiting network events from backend.</span></div>
      </div>
    </div>
  </main>

  <footer>
    <span>DCN PROJECT v2.4.1</span>
    <span>¬© 2026 DCN Project ‚Äî Adaptive Intelligence for Next-Gen Networks</span>
    <span id="footer-time">SYS TIME: --:--:--</span>
  </footer>

  <script>
    // Clock
    function updateClock() {
      const now = new Date();
      const t = now.toTimeString().slice(0, 8);
      document.getElementById('clock').textContent = t;
      document.getElementById('footer-time').textContent = 'SYS TIME: ' + t;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Chart utility
    function drawSparkline(canvas, data, color, fill) {
      const ctx = canvas.getContext('2d');
      const W = canvas.offsetWidth || 200;
      const H = canvas.offsetHeight || 60;
      canvas.width = W * devicePixelRatio;
      canvas.height = H * devicePixelRatio;
      ctx.scale(devicePixelRatio, devicePixelRatio);
      ctx.clearRect(0, 0, W, H);
      const min = Math.min(...data), max = Math.max(...data);
      const range = max - min || 1;
      const pts = data.map((v, i) => [i / (data.length - 1) * W, H - ((v - min) / range * (H - 10) + 5)]);
      if (fill) {
        ctx.beginPath();
        ctx.moveTo(pts[0][0], H);
        pts.forEach(p => ctx.lineTo(p[0], p[1]));
        ctx.lineTo(pts[pts.length - 1][0], H);
        ctx.closePath();
        const grad = ctx.createLinearGradient(0, 0, 0, H);
        grad.addColorStop(0, color + '44');
        grad.addColorStop(1, color + '00');
        ctx.fillStyle = grad;
        ctx.fill();
      }
      ctx.beginPath();
      pts.forEach((p, i) => i === 0 ? ctx.moveTo(p[0], p[1]) : ctx.lineTo(p[0], p[1]));
      ctx.strokeStyle = color;
      ctx.lineWidth = 2;
      ctx.stroke();
      // latest dot
      const last = pts[pts.length - 1];
      ctx.beginPath();
      ctx.arc(last[0], last[1], 3, 0, Math.PI * 2);
      ctx.fillStyle = color;
      ctx.fill();
    }

    // Data stores
    const N = 40;
    let delayData = Array.from({ length: N }, () => 10 + Math.random() * 8);
    let tputData = Array.from({ length: N }, () => 4 + Math.random() * 1.5);
    let lossData = Array.from({ length: N }, () => 0.05 + Math.random() * 0.15);
    let trafficData = Array.from({ length: N }, () => 50 + Math.random() * 30);

    // Standalone Mock Generator
    let phase = 0.0;
    let lastUpdate = Date.now() / 1000;

    // Virtual Config State
    let activeConfig = {
      voipAlloc: 50,
      threshold: 0.4,
      ftpPrio: "std"
    };

    // User alerts queue for mock state
    let pendingAlerts = [];
    let mockDataset = [];
    let lastMinuteSample = null;

    async function applyConfig() {
      activeConfig.voipAlloc = parseInt(document.getElementById('config-voip-alloc').value) || 50;
      activeConfig.threshold = parseFloat(document.getElementById('config-threshold').value) || 0.4;
      activeConfig.ftpPrio = document.getElementById('config-ftp-prio').value || "std";

      try {
        const res = await fetch('http://127.0.0.1:5000/api/config', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            voip_alloc: activeConfig.voipAlloc,
            threshold: activeConfig.threshold,
            ftp_prio: activeConfig.ftpPrio
          })
        });
        if (res.ok) {
          const now_str = new Date().toTimeString().slice(0, 8);
          pendingAlerts.push({ time: now_str, msg: "SYS: Remote QoS Policy Synchronized", cls: "ok" });
        }
      } catch (e) {
        console.warn("Failed to sync config with backend:", e);
      }

      const now_str = new Date().toTimeString().slice(0, 8);
      pendingAlerts.push({ time: now_str, msg: "USER: QoS Policy Configuration Applied Locally", cls: "ok" });
    }

    function resetConfig() {
      document.getElementById('config-voip-alloc').value = 50;
      document.getElementById('config-threshold').value = 0.4;
      document.getElementById('config-ftp-prio').value = "std";
      applyConfig();
      const now_str = new Date().toTimeString().slice(0, 8);
      pendingAlerts.push({ time: now_str, msg: "USER: Reverted to Default Policies", cls: "warn" });
    }

    function getMockState() {
      const now = Date.now() / 1000;
      const dt = now - lastUpdate;
      phase += dt * 0.2;
      lastUpdate = now;

      const cycle = Math.sin(phase);
      const randUniform = (min, max) => Math.random() * (max - min) + min;
      const randInt = (min, max) => Math.floor(randUniform(min, max + 1));

      const voip_kbps = Math.max(50, 120 + 40 * cycle + randUniform(-10, 10));
      const http_mbps = Math.max(1.0, 4.0 + 3.0 * cycle + randUniform(-0.5, 0.5));
      const ftp_mbps = Math.max(0.1, 2.0 + 1.0 * Math.sin(phase * 0.3) + randUniform(-0.5, 1.5));

      const total_load = (voip_kbps / 1000.0) + http_mbps + ftp_mbps;
      const arrival_rate = Math.floor(total_load * 120 + randUniform(-50, 50));

      const capacity = 12.0;
      const utilization_ratio = Math.min(0.99, total_load / capacity);
      const base_delay = 5.0 / (1.0 - utilization_ratio) + randUniform(-2, 2);

      const queue_length = Math.floor(Math.max(0, (total_load - 5.0) * 50 + randUniform(0, 20)));

      const confidence = parseFloat(randUniform(85.0, 98.0).toFixed(1));
      const infer_time = randInt(5, 15);

      let state = "low";
      if (utilization_ratio < activeConfig.threshold) state = "low";
      else if (utilization_ratio < Math.min(0.95, activeConfig.threshold + 0.35)) state = "med";
      else state = "high";

      let bw_voip = 20, bw_http = 50, bw_ftp = 30;
      let q_voip = 10, q_http = 30, q_ftp = 60;

      if (state === "med") {
        bw_voip = 30; bw_http = 45; bw_ftp = 25;
        q_voip = 20; q_http = 40; q_ftp = 40;
        if (activeConfig.ftpPrio === "high") { bw_ftp += 10; bw_http -= 10; q_ftp -= 10; q_http += 10; }
        if (activeConfig.ftpPrio === "low") { bw_ftp -= 10; bw_http += 10; q_ftp += 10; q_http -= 10; }
      } else if (state === "high") {
        // Apply VoIP allocation from config
        bw_voip = activeConfig.voipAlloc;
        // Distribute remaining
        const rem = 100 - bw_voip;
        bw_http = Math.floor(rem * 0.7);
        bw_ftp = rem - bw_http;

        q_voip = 50; q_http = 30; q_ftp = 20;
        if (activeConfig.ftpPrio === "high") { q_ftp -= 10; q_http += 10; }
      }

      const link_utilization = Math.min(100, Math.floor(utilization_ratio * 100));
      const queue_occupancy = Math.min(100, Math.floor((queue_length / 500.0) * 100));

      let final_delay = base_delay, packet_loss = randUniform(0.01, 0.05);
      if (state === "high") {
        final_delay = base_delay * 0.8;
        packet_loss = 0.5 + (utilization_ratio - 0.75) * 5.0 + randUniform(0, 0.5);
        // FTP config alters loss characteristics slightly
        if (activeConfig.ftpPrio === "high") { packet_loss *= 0.8; final_delay *= 1.1; }
      } else if (state === "med") {
        final_delay = base_delay * 0.9;
        packet_loss = randUniform(0.05, 0.3);
      }

      const final_tput = total_load * (1.0 - packet_loss / 100.0);

      const alerts = [...pendingAlerts];
      pendingAlerts = []; // clear

      const now_str = new Date().toTimeString().slice(0, 8);
      if (utilization_ratio > 0.85) {
        alerts.push({ time: now_str, msg: "Critical link utilization detected > 85%", cls: "crit" });
      } else if (state === "high" && alerts.length === 0) {
        alerts.push({ time: now_str, msg: `QoS active: VoIP bandwidth reserved at ${bw_voip}%`, cls: "warn" });
      } else if (state === "low" && Math.random() < 0.1 && alerts.length === 0) {
        alerts.push({ time: now_str, msg: "Nominal traffic conditions - Policy reset", cls: "ok" });
      }

      if (packet_loss > 1.0 && alerts.length === 0) {
        alerts.push({ time: now_str, msg: `Packet loss elevated (${packet_loss.toFixed(1)}%) on background queues`, cls: "warn" });
      }

      const metrics = {
        traffic: { voip: Math.round(voip_kbps), http: parseFloat(http_mbps.toFixed(1)), ftp: parseFloat(ftp_mbps.toFixed(1)), aggregate: parseFloat(total_load.toFixed(1)) },
        monitoring: { arrival_rate, delay: parseFloat(base_delay.toFixed(1)), queue_length },
        ml: { state, confidence, infer_time },
        qos: { bandwidth: { voip: bw_voip, http: bw_http, ftp: bw_ftp }, queues: { voip: q_voip, http: q_http, ftp: q_ftp } },
        router: { link_utilization, queue_occupancy },
        performance: { delay: parseFloat(final_delay.toFixed(1)), throughput: parseFloat(final_tput.toFixed(2)), packet_loss: parseFloat(packet_loss.toFixed(2)) },
        alerts
      };

      // Mock Dataset Sample (1-minute interval)
      const currentMin = now_str.slice(0, 5); // "HH:MM"
      if (currentMin !== lastMinuteSample) {
        mockDataset.unshift({
          time: now_str,
          voip: metrics.traffic.voip,
          http: metrics.traffic.http,
          ftp: metrics.traffic.ftp,
          delay: metrics.performance.delay,
          throughput: metrics.performance.throughput,
          loss: metrics.performance.loss || metrics.performance.packet_loss,
          state: metrics.ml.state
        });
        if (mockDataset.length > 50) mockDataset.pop();
        lastMinuteSample = currentMin;
      }

      return metrics;
    }

    // API Data Poll
    async function fetchState() {
      let data;
      try {
        const res = await fetch('http://127.0.0.1:5000/api/status');
        if (!res.ok) throw new Error("HTTP Request Failed");
        data = await res.json();
      } catch (e) {
        // Fallback to standalone mode if backend is not running
        data = getMockState();
      }

      try {
        // Update Charts Data
        delayData.push(data.performance.delay); delayData.shift();
        tputData.push(data.performance.throughput); tputData.shift();
        lossData.push(data.performance.packet_loss); lossData.shift();
        trafficData.push(data.traffic.aggregate); trafficData.shift();

        drawSparkline(document.getElementById('delayChart'), delayData, '#00ff88', true);
        drawSparkline(document.getElementById('tputChart'), tputData, '#00d4ff', true);
        drawSparkline(document.getElementById('lossChart'), lossData, '#ffb700', true);
        drawSparkline(document.getElementById('trafficChart'), trafficData, '#00d4ff', true);

        // Performance Values
        document.getElementById('delay-val').textContent = data.monitoring.delay.toFixed(1);
        document.getElementById('perf-delay').textContent = data.performance.delay.toFixed(1) + ' ms';
        document.getElementById('perf-tput').textContent = data.performance.throughput.toFixed(2) + ' Gbps';
        document.getElementById('perf-loss').textContent = data.performance.packet_loss.toFixed(2) + '%';

        // Traffic Sources
        document.getElementById('voip-val').textContent = data.traffic.voip + ' Kbps';
        document.getElementById('voip-bar').style.width = Math.min(100, (data.traffic.voip / 200 * 100)) + '%';
        document.getElementById('http-val').textContent = data.traffic.http.toFixed(1) + ' Mbps';
        document.getElementById('http-bar').style.width = Math.min(100, (data.traffic.http / 12 * 100)) + '%';
        document.getElementById('ftp-val').textContent = data.traffic.ftp.toFixed(1) + ' Mbps';
        document.getElementById('ftp-bar').style.width = Math.min(100, (data.traffic.ftp / 5 * 100)) + '%';

        // Monitoring
        document.getElementById('arrival-rate').textContent = data.monitoring.arrival_rate;
        document.getElementById('queue-val').textContent = data.monitoring.queue_length;

        // Feature Extraction Animation
        const statusEl = document.getElementById('extraction-status');
        const vectorEl = document.getElementById('feature-vector');
        const progressEl = document.getElementById('feature-progress');
        const appEl = document.getElementById('extraction-app');
        const tags = ['feat-jitter', 'feat-tput', 'feat-loss', 'feat-rtt', 'feat-burst'];
        const mockApps = ['Coursera HD Stream', 'Wikipedia API', 'Netflix 4K Flow', 'TikTok Metadata', 'Canvas CMS Sync'];

        if (statusEl && vectorEl && progressEl && appEl) {
          // Trigger animation cycle
          statusEl.textContent = "EXTRACTING";
          statusEl.style.color = "var(--accent)";
          appEl.textContent = "ANALYZING FLOW...";
          appEl.style.color = "var(--dim)";

          // Move progress bar
          progressEl.style.transition = "none";
          progressEl.style.left = "-100%";
          setTimeout(() => {
            progressEl.style.transition = "left 1.5s linear";
            progressEl.style.left = "100%";
          }, 50);

          // Generate random feature vector
          const vec = Array.from({ length: 5 }, () => Math.random().toFixed(2));
          vectorEl.textContent = `[${vec.join(', ')}]`;

          // Highlight random tags
          tags.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.classList.remove('active-feat');
          });
          const activeId = tags[Math.floor(Math.random() * tags.length)];
          const activeEl = document.getElementById(activeId);
          if (activeEl) activeEl.classList.add('active-feat');

          setTimeout(() => {
            statusEl.textContent = "COMPLETE (L7)";
            statusEl.style.color = "var(--green)";
            const identified = mockApps[Math.floor(Math.random() * mockApps.length)];
            appEl.textContent = identified;
            appEl.style.color = identified.includes('Netflix') || identified.includes('TikTok') ? 'var(--red)' : 'var(--green)';
          }, 1600);
        }

        // ML Predictor Animation Logic continua after...
        ['low', 'med', 'high'].forEach(s => {
          document.getElementById('state-' + s).classList.toggle('active-state', s === data.ml.state);
        });
        document.getElementById('confidence').textContent = data.ml.confidence + '%';
        document.getElementById('infer-time').textContent = data.ml.infer_time + 'ms';

        // Analytics Engine Animation
        const accuracySpan = document.getElementById('analytics-accuracy');
        const inferSpan = document.getElementById('analytics-infer');
        if (accuracySpan && inferSpan) {
          // Fluctuate accuracy slightly around 96.8
          const rAcc = 96.0 + Math.random() * 1.5;
          accuracySpan.textContent = rAcc.toFixed(1) + '%';
          // Fluctuate inference time
          const rInf = Math.floor(8 + Math.random() * 6);
          inferSpan.textContent = '~' + rInf + 'ms';

          // Randomly flash status to "RETRAINING..." briefly
          const statusEl = document.getElementById('analytics-status');
          if (statusEl) {
            if (Math.random() < 0.1) {
              statusEl.textContent = "ENGINE ACTIVE: RETRAINING MODEL...";
              statusEl.style.color = "var(--accent)";
            } else {
              statusEl.textContent = "ENGINE ACTIVE: CONTINUOUS LEARNING PIPELINE";
              statusEl.style.color = "var(--green)";
            }
          }
        }

        // Deep Packet Inspection App Animation
        const edu1 = document.getElementById('app-edu1-bar');
        const edu2 = document.getElementById('app-edu2-bar');
        const edu3 = document.getElementById('app-edu3-bar');
        const ent1 = document.getElementById('app-ent1-bar');
        const ent2 = document.getElementById('app-ent2-bar');
        const ent3 = document.getElementById('app-ent3-bar');

        if (edu1) { // If panel exists
          const e1 = 35 + Math.random() * 20;
          const e2 = 5 + Math.random() * 15;
          const e3 = 20 + Math.random() * 15;

          document.getElementById('app-edu1-val').textContent = e1.toFixed(1) + ' Mbps';
          document.getElementById('app-edu2-val').textContent = e2.toFixed(1) + ' Mbps';
          document.getElementById('app-edu3-val').textContent = e3.toFixed(1) + ' Mbps';

          edu1.style.width = Math.min(100, e1 / 60 * 100) + '%';
          edu2.style.width = Math.min(100, e2 / 30 * 100) + '%';
          edu3.style.width = Math.min(100, e3 / 40 * 100) + '%';

          // Entertainment is heavily throttled under load
          let throttleMultiplier = 1.0;
          if (data.ml.state === "high") throttleMultiplier = 0.2;
          else if (data.ml.state === "med") throttleMultiplier = 0.5;

          const n1 = (2 + Math.random() * 8) * throttleMultiplier;
          const n2 = (0.5 + Math.random() * 3) * throttleMultiplier;
          const n3 = (1 + Math.random() * 12) * throttleMultiplier;

          document.getElementById('app-ent1-val').textContent = n1.toFixed(1) + ' Mbps' + (throttleMultiplier < 1 ? ' (Capped)' : '');
          document.getElementById('app-ent2-val').textContent = n2.toFixed(1) + ' Mbps' + (throttleMultiplier < 1 ? ' (Capped)' : '');
          document.getElementById('app-ent3-val').textContent = n3.toFixed(1) + ' Mbps' + (throttleMultiplier < 1 ? ' (Capped)' : '');

          ent1.style.width = Math.min(100, n1 / 20 * 100) + '%';
          ent2.style.width = Math.min(100, n2 / 10 * 100) + '%';
          ent3.style.width = Math.min(100, n3 / 25 * 100) + '%';
        }

        // Adaptive QoS Controllers
        const qos = data.qos;
        document.getElementById('q1').style.width = qos.queues.voip + '%';
        document.getElementById('q2').style.width = qos.queues.http + '%';
        document.getElementById('q3').style.width = qos.queues.ftp + '%';
        document.getElementById('bw1').textContent = qos.bandwidth.voip + '%';
        document.getElementById('bwf1').style.width = qos.bandwidth.voip + '%';
        document.getElementById('bw2').textContent = qos.bandwidth.http + '%';
        document.getElementById('bwf2').style.width = qos.bandwidth.http + '%';
        document.getElementById('bw3').textContent = qos.bandwidth.ftp + '%';
        document.getElementById('bwf3').style.width = qos.bandwidth.ftp + '%';

        // Router Utilization
        document.getElementById('link-util').textContent = data.router.link_utilization + '%';
        document.getElementById('link-fill').style.width = data.router.link_utilization + '%';
        document.getElementById('queue-occ').textContent = data.router.queue_occupancy + '%';
        document.getElementById('queue-fill').style.width = data.router.queue_occupancy + '%';

        // Alerts
        if (data.alerts && data.alerts.length > 0) {
          const list = document.getElementById('alert-list');
          const fullList = document.getElementById('full-log-list');
          data.alerts.forEach(msg => {
            const item = document.createElement('div');
            item.className = 'alert-item';
            item.innerHTML = `<span class="alert-time" style="width:80px; display:inline-block; color:var(--dim);">${msg.time}</span><span class="alert-msg ${msg.cls}">${msg.msg}</span>`;
            list.insertBefore(item, list.firstChild);
            if (list.children.length > 8) list.removeChild(list.lastChild);

            if (fullList) {
              const logItem = document.createElement('div');
              logItem.className = 'alert-item';
              logItem.style.borderBottom = '1px solid rgba(10,64,96,0.3)';
              logItem.style.padding = '8px 0';
              logItem.innerHTML = item.innerHTML;
              fullList.insertBefore(logItem, fullList.firstChild);
              if (fullList.children.length > 200) fullList.removeChild(fullList.lastChild);
            }
          });
        }
      } catch (e) {
        console.warn("Error processing data:", e);
      }
    }

    async function fetchDataset() {
      let data;
      try {
        const res = await fetch('http://127.0.0.1:5000/api/dataset');
        if (!res.ok) throw new Error("Dataset fetch failed");
        data = await res.json();
      } catch (e) {
        // Fallback to local mock dataset
        data = mockDataset;
      }

      const body = document.getElementById('dataset-body');
      if (!body || !data) return;

      body.innerHTML = '';
      data.forEach(row => {
        const tr = document.createElement('tr');
        tr.style.borderBottom = '1px solid var(--border)';
        tr.style.backgroundColor = 'rgba(0,0,0,0.1)';

        const stateColor = row.state === 'high' ? 'var(--red)' : (row.state === 'med' ? 'var(--accent)' : 'var(--green)');

        tr.innerHTML = `
          <td style="padding: 8px 10px; font-family: 'Share Tech Mono'; color: var(--dim);">${row.time}</td>
          <td style="padding: 8px 10px; border-left: 1px solid var(--border);">${row.voip}</td>
          <td style="padding: 8px 10px; border-left: 1px solid var(--border);">${row.http}</td>
          <td style="padding: 8px 10px; border-left: 1px solid var(--border);">${row.ftp}</td>
          <td style="padding: 8px 10px; border-left: 1px solid var(--border);">${row.delay}</td>
          <td style="padding: 8px 10px; border-left: 1px solid var(--border);">${row.throughput}</td>
          <td style="padding: 8px 10px; border-left: 1px solid var(--border);">${row.loss}</td>
          <td style="padding: 8px 10px; border-left: 1px solid var(--border); color: ${stateColor}; font-weight: bold;">${row.state ? row.state.toUpperCase() : 'UNKNOWN'}</td>
        `;
        body.appendChild(tr);
      });
    }

    // Init polling
    window.addEventListener('load', () => {
      setInterval(fetchState, 2000);
      setInterval(fetchDataset, 4000);
      fetchState();
      fetchDataset();
    });

    // Nav tab interaction
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const targetId = this.getAttribute('data-target');
        if (!targetId) return; // Ignore buttons without targets

        // Update active tab Button
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        // Update active View
        document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active-view'));
        const targetEl = document.getElementById(targetId);
        if (targetEl) targetEl.classList.add('active-view');

        // Special handling for map resize
        if (targetId === 'view-map' && window.networkMap) {
          setTimeout(() => {
            window.networkMap.invalidateSize();
          }, 200);
        }
      });
    });

    // --- MAP LOGIC ---
    window.networkMap = null;
    const hubs = [
      { name: "Bengaluru", lat: 12.9716, lng: 77.5946, intensity: 1.0 }
    ];

    function initNetworkMap() {
      if (window.networkMap) return;

      window.networkMap = L.map('map-container', {
        zoomControl: false,
        attributionControl: false
      }).setView([20, 0], 2); // Global view

      L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        maxZoom: 19
      }).addTo(window.networkMap);

      // Initialize Heatmap
      const heatPoints = hubs.map(h => [h.lat, h.lng, h.intensity]);
      window.heatLayer = L.heatLayer(heatPoints, {
        radius: 35,
        blur: 20,
        maxZoom: 10,
        gradient: { 0.4: 'cyan', 0.65: 'lime', 1: 'red' }
      }).addTo(window.networkMap);

      const hubIcon = L.divIcon({
        className: 'hub-icon-container',
        html: '<div class="hub-pulse" style="width:8px; height:8px;"></div>',
        iconSize: [12, 12]
      });

      hubs.forEach(h => {
        L.marker([h.lat, h.lng], { icon: hubIcon })
          .addTo(window.networkMap)
          .bindPopup(`<b style="color:var(--accent)">${h.name}</b><br>Traffic Intensity: <span id="int-${h.name.replace(/\s+/g, '')}">${h.intensity}</span>`);
      });

      // Dynamic Traffic lines
      window.trafficLines = [];
      function updateMapTraffic() {
        if (!window.networkMap || !window.heatLayer) return;

        const globalScale = window.lastMetrics ? (window.lastMetrics.traffic.aggregate / 5) : 1.0;
        let points = [];

        // Focus Heat on Active Target Hubs (Global or Local)
        hubs.forEach(h => {
          const scaledIntensity = h.intensity * globalScale * (0.8 + Math.random() * 0.4);
          const span = document.getElementById(`int-${h.name.replace(/\s+/g, '')}`);
          if (span) span.innerText = scaledIntensity.toFixed(2);
          points.push([h.lat, h.lng, scaledIntensity]);
        });

        // Add heat for user's active marker
        if (window.userMarker) {
          const pos = window.userMarker.getLatLng();
          points.push([pos.lat, pos.lng, 2.0 * globalScale]);
        }

        window.heatLayer.setLatLngs(points);

        // Remove old lines
        window.trafficLines.forEach(l => window.networkMap.removeLayer(l));
        window.trafficLines = [];

        // Simplified lines for clarity
        if (window.userMarker && hubs.length > 0) {
          const upos = window.userMarker.getLatLng();
          const hpos = hubs[0];
          const line = L.polyline([
            [upos.lat, upos.lng],
            [hpos.lat, hpos.lng]
          ], {
            color: 'var(--accent)',
            weight: 2,
            opacity: 0.6,
            dashArray: '10, 20'
          }).addTo(window.networkMap);
          window.trafficLines.push(line);
        }
      }

      setInterval(updateMapTraffic, 3000);
      updateMapTraffic();
    }

    async function searchLocation() {
      if (window.location.protocol === 'file:') {
        alert("SECURITY ALERT: MAP TARGETING (CORS) IS BLOCKED WHEN OPENED AS A LOCAL FILE.\n\nPLEASE USE THE LOCAL SERVER URL INSTEAD:\nhttp://127.0.0.1:5000");
        return;
      }

      const q = document.getElementById('map-search-input').value;
      if (!q) return;

      try {
        const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(q)}`);
        const data = await res.json();
        if (data && data.length > 0) {
          const lat = parseFloat(data[0].lat);
          const lon = parseFloat(data[0].lon);
          // Use user's query as label for cleaner visual
          focusOnLocation(lat, lon, q.toUpperCase());
        } else {
          alert("LOCATION NOT FOUND IN DATABASE.");
        }
      } catch (e) {
        console.warn("Geocoding failed:", e);
        alert("GEOTARGETING ERROR: UNABLE TO CONNECT TO REMOTE DATABASE.");
      }
    }

    function autoDetectLocation() {
      if (!navigator.geolocation) {
        alert("GEOLOCATION NOT SUPPORTED BY SYSTEM.");
        return;
      }

      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = "SCANNING...";

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          focusOnLocation(pos.coords.latitude, pos.coords.longitude, "SCAN-DETECTED AREA");
          btn.textContent = originalText;
        },
        (err) => {
          alert("GEOLOCATION DENIED OR UNAVAILABLE.");
          btn.textContent = originalText;
        }
      );
    }

    window.userMarker = null;
    window.localHubs = [];

    function focusOnLocation(lat, lng, label) {
      if (!window.networkMap) return;

      window.networkMap.setView([lat, lng], 13);

      if (window.userMarker) window.networkMap.removeLayer(window.userMarker);

      const userIcon = L.divIcon({
        className: 'user-icon-container',
        html: '<div class="hub-pulse" style="background:var(--red); box-shadow: 0 0 15px var(--red);"></div>',
        iconSize: [30, 30]
      });

      window.userMarker = L.marker([lat, lng], { icon: userIcon })
        .addTo(window.networkMap)
        .bindPopup(`<b style="color:var(--red)">YOUR LOCATION</b><br>${label}`)
        .bindTooltip(label, { permanent: true, direction: 'top', className: 'user-tooltip' })
        .openPopup();

      // Clear old local hubs
      window.localHubs.forEach(h => window.networkMap.removeLayer(h));
      window.localHubs = [];

      // Generate localized "Nearby" hubs around the new center
      for (let i = 0; i < 4; i++) {
        const dLat = (Math.random() - 0.5) * 0.02;
        const dLng = (Math.random() - 0.5) * 0.02;
        const hub = L.marker([lat + dLat, lng + dLng], {
          icon: L.divIcon({
            className: 'hub-icon-container',
            html: '<div class="hub-pulse" style="background:var(--accent); width:8px; height:8px;"></div>',
            iconSize: [15, 15]
          })
        }).addTo(window.networkMap)
          .bindPopup(`<b>LOCAL-HUB-${Math.floor(Math.random() * 900 + 100)}</b><br>Signal: Strong`);
        window.localHubs.push(hub);
      }

      // Update global traffic lines to include new context potentially
      if (window.updateMapTraffic) window.updateMapTraffic();
    }

    // Initialize map on load if needed
    window.addEventListener('load', () => {
      initNetworkMap();
    });
  </script>
</body>

</html>